@page
@model SelectPaymentMethodModel
@{
    ViewData["Title"] = "Select Payment Method";
}

<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex align-items-center">
                <div class="flex-grow-1">
                    <div class="progress" style="height: 30px;">
                        <div class="progress-bar bg-success" role="progressbar" style="width: 33.33%;" aria-valuenow="33" aria-valuemin="0" aria-valuemax="100">
                            <i class="bi bi-check-circle"></i> Info
                        </div>
                        <div class="progress-bar bg-primary" role="progressbar" style="width: 33.33%;" aria-valuenow="33" aria-valuemin="0" aria-valuemax="100">
                            <strong>Payment Method</strong>
                        </div>
                        <div class="progress-bar bg-secondary" role="progressbar" style="width: 33.33%;" aria-valuenow="33" aria-valuemin="0" aria-valuemax="100">
                            Payment Details
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <h1 class="mb-4">Choose Your Payment Method</h1>

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            @TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <div class="row">
        <div class="col-lg-8">
            <!-- Shipping Information Review -->
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="bi bi-check-circle-fill text-success"></i> Shipping Information</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p class="mb-1"><strong>Contact:</strong></p>
                            <p class="text-muted">@Model.Email</p>
                            <p class="text-muted">@Model.PhoneNumber</p>
                        </div>
                        <div class="col-md-6">
                            <p class="mb-1"><strong>Ship to:</strong></p>
                            <p class="text-muted mb-0">@Model.ShippingAddress</p>
                            <p class="text-muted">@Model.ShippingCity, @Model.ShippingState @Model.ShippingZip</p>
                        </div>
                    </div>
                    <a asp-page="/Checkout/Index" class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-pencil"></i> Edit Information
                    </a>
                </div>
            </div>

            <!-- Payment Method Selection -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-credit-card"></i> Select Payment Method</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-4">Choose how you'd like to pay for your order:</p>

                    <form method="post" asp-page-handler="SelectMethod">
                        <div class="row g-3">
                            <!-- Credit/Debit Card -->
                            <div class="col-md-6">
                                <label class="payment-method-card">
                                    <input type="radio" name="paymentMethod" value="card" class="payment-method-radio" required>
                                    <div class="payment-method-content">
                                        <div class="payment-method-icon text-primary">
                                            <i class="bi bi-credit-card-2-front" style="font-size: 2.5rem;"></i>
                                        </div>
                                        <h5 class="mt-3">Credit or Debit Card</h5>
                                        <p class="text-muted small mb-2">Pay with your card</p>
                                        <div class="d-flex gap-2 justify-content-center flex-wrap">
                                            <span class="badge bg-primary">Visa</span>
                                            <span class="badge bg-primary">Mastercard</span>
                                            <span class="badge bg-primary">Amex</span>
                                            <span class="badge bg-primary">Discover</span>
                                        </div>
                                        <div class="mt-2">
                                            <small class="text-success"><i class="bi bi-check-circle-fill"></i> Instant payment</small>
                                        </div>
                                    </div>
                                </label>
                            </div>

                            <!-- Google Pay -->
                            <div class="col-md-6">
                                <label class="payment-method-card">
                                    <input type="radio" name="paymentMethod" value="card" class="payment-method-radio">
                                    <div class="payment-method-content">
                                        <div class="payment-method-icon text-primary">
                                            <i class="bi bi-google" style="font-size: 2.5rem;"></i>
                                        </div>
                                        <h5 class="mt-3">Google Pay</h5>
                                        <p class="text-muted small mb-2">Fast, secure Google checkout</p>
                                        <div class="mt-2">
                                            <small class="text-muted"><i class="bi bi-phone"></i> Chrome & Android</small>
                                        </div>
                                        <div class="mt-2">
                                            <small class="text-success"><i class="bi bi-check-circle-fill"></i> Auto-detected</small>
                                        </div>
                                        <div class="mt-1">
                                            <small class="text-info"><i class="bi bi-info-circle"></i> Shows if available</small>
                                        </div>
                                    </div>
                                </label>
                            </div>

                            <!-- Apple Pay -->
                            <div class="col-md-6">
                                <label class="payment-method-card">
                                    <input type="radio" name="paymentMethod" value="card" class="payment-method-radio">
                                    <div class="payment-method-content">
                                        <div class="payment-method-icon">
                                            <i class="bi bi-apple" style="font-size: 2.5rem;"></i>
                                        </div>
                                        <h5 class="mt-3">Apple Pay</h5>
                                        <p class="text-muted small mb-2">Pay with Touch ID or Face ID</p>
                                        <div class="mt-2">
                                            <small class="text-muted"><i class="bi bi-phone"></i> Safari & iOS</small>
                                        </div>
                                        <div class="mt-2">
                                            <small class="text-success"><i class="bi bi-check-circle-fill"></i> Auto-detected</small>
                                        </div>
                                        <div class="mt-1">
                                            <small class="text-info"><i class="bi bi-info-circle"></i> Shows if available</small>
                                        </div>
                                    </div>
                                </label>
                            </div>

                            <!-- Cash App Pay -->
                            <div class="col-md-6">
                                <label class="payment-method-card">
                                    <input type="radio" name="paymentMethod" value="cashapp" class="payment-method-radio">
                                    <div class="payment-method-content">
                                        <div class="payment-method-icon text-success">
                                            <i class="bi bi-cash-coin" style="font-size: 2.5rem;"></i>
                                        </div>
                                        <h5 class="mt-3">Cash App Pay</h5>
                                        <p class="text-muted small mb-2">Pay from Cash App balance</p>
                                        <div class="mt-2">
                                            <small class="text-muted"><i class="bi bi-geo-alt"></i> US only</small>
                                        </div>
                                        <div class="mt-2">
                                            <small class="text-success"><i class="bi bi-check-circle-fill"></i> Instant transfer</small>
                                        </div>
                                    </div>
                                </label>
                            </div>

                            <!-- Link by Stripe -->
                            <div class="col-md-6">
                                <label class="payment-method-card">
                                    <input type="radio" name="paymentMethod" value="link" class="payment-method-radio">
                                    <div class="payment-method-content">
                                        <div class="payment-method-icon text-info">
                                            <i class="bi bi-link-45deg" style="font-size: 2.5rem;"></i>
                                        </div>
                                        <h5 class="mt-3">Link</h5>
                                        <p class="text-muted small mb-2">Save details for faster checkout</p>
                                        <div class="mt-2">
                                            <small class="text-muted"><i class="bi bi-lightning-charge"></i> Faster returns</small>
                                        </div>
                                        <div class="mt-2">
                                            <small class="text-success"><i class="bi bi-check-circle-fill"></i> One-click pay</small>
                                        </div>
                                    </div>
                                </label>
                            </div>

                            <!-- Bank Account (ACH) -->
                            <div class="col-md-6">
                                <label class="payment-method-card">
                                    <input type="radio" name="paymentMethod" value="us_bank_account" class="payment-method-radio">
                                    <div class="payment-method-content">
                                        <div class="payment-method-icon text-warning">
                                            <i class="bi bi-bank" style="font-size: 2.5rem;"></i>
                                        </div>
                                        <h5 class="mt-3">Bank Account</h5>
                                        <p class="text-muted small mb-2">Direct bank transfer (ACH)</p>
                                        <div class="mt-2">
                                            <small class="text-muted"><i class="bi bi-clock"></i> 3-5 business days</small>
                                        </div>
                                        <div class="mt-2">
                                            <small class="text-info"><i class="bi bi-piggy-bank"></i> Lower fees</small>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-between mt-4">
                            <a asp-page="/Checkout/Index" class="btn btn-outline-secondary btn-lg">
                                <i class="bi bi-arrow-left"></i> Back
                            </a>
                            <button type="submit" class="btn btn-primary btn-lg">
                                Continue to Payment <i class="bi bi-arrow-right"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Security Info -->
            <div class="alert alert-info">
                <i class="bi bi-shield-lock-fill"></i> <strong>Secure Checkout:</strong> All payment methods are encrypted and PCI-DSS compliant. Your information is always protected.
            </div>
        </div>

        <div class="col-lg-4">
            <!-- Order Summary -->
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Order Summary</h5>
                </div>
                <div class="card-body">
                    @foreach (var item in Model.CartItems)
                    {
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">@item.ProductName <small class="text-muted">(x@(item.Quantity))</small></span>
                            <strong>$@item.Subtotal.ToString("F2")</strong>
                        </div>
                    }
                    <hr>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Subtotal:</span>
                        <strong>$@Model.Subtotal.ToString("F2")</strong>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Tax (@Model.ShippingState):</span>
                        <strong>$@Model.TaxAmount.ToString("F2")</strong>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Shipping:</span>
                        <strong class="text-success">FREE</strong>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between">
                        <h5>Total:</h5>
                        <h5 class="text-success"><strong>$@Model.Total.ToString("F2")</strong></h5>
                    </div>
                </div>
            </div>

            <!-- Why Choose Us -->
            <div class="card">
                <div class="card-body">
                    <h6 class="card-title"><i class="bi bi-shield-check"></i> Why Shop With Us</h6>
                    <ul class="list-unstyled mb-0">
                        <li class="mb-2">
                            <small><i class="bi bi-check-circle text-success"></i> Free shipping on all orders</small>
                        </li>
                        <li class="mb-2">
                            <small><i class="bi bi-check-circle text-success"></i> Secure payment processing</small>
                        </li>
                        <li class="mb-2">
                            <small><i class="bi bi-check-circle text-success"></i> 30-day return policy</small>
                        </li>
                        <li>
                            <small><i class="bi bi-check-circle text-success"></i> 24/7 customer support</small>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .payment-method-card {
        cursor: pointer;
        display: block;
        height: 100%;
        position: relative;
    }

    .payment-method-content {
        border: 2px solid #dee2e6;
        border-radius: 0.5rem;
        padding: 1.5rem;
        text-align: center;
        transition: all 0.3s ease;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        position: relative;
    }

    .payment-method-card:hover .payment-method-content {
        border-color: #0d6efd;
        box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.15);
        transform: translateY(-2px);
    }

    .payment-method-radio {
        position: absolute;
        opacity: 0;
        pointer-events: none;
    }

    .payment-method-radio:checked + .payment-method-content {
        border-color: #198754;
        background-color: #f8f9fa;
        box-shadow: 0 0 0 0.25rem rgba(25, 135, 84, 0.25);
    }

    .payment-method-radio:checked + .payment-method-content::after {
        font-family: 'bootstrap-icons' !important;
        content: '\f26b';
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: #198754;
        color: white;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 1.2rem;
        line-height: 30px;
    }

    .payment-method-icon {
        margin-bottom: 0.5rem;
    }

    .payment-method-content h5 {
        margin-bottom: 0.5rem;
        font-size: 1.1rem;
    }

    .payment-method-content p {
        margin-bottom: 0;
    }
</style>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Add click event to entire card
            $('.payment-method-card').on('click', function () {
                $(this).find('.payment-method-radio').prop('checked', true);
            });

            // Prevent double-click on radio button
            $('.payment-method-radio').on('click', function (e) {
                e.stopPropagation();
            });
        });
    </script>
}
